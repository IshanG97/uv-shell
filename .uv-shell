# UV shell utilities
# Created: January 19, 2025

# Function to freeze packages to pyproject.toml
freeze_packages() {
    if [[ -z "$VIRTUAL_ENV" ]]; then
        echo "âŒ Not in a virtual environment"
        echo "ğŸ“ Run 'uvshell' first to activate your environment"
        return 1
    fi
    
    echo "ğŸ”„ Freezing all installed packages to requirements.txt"
    uv pip freeze > requirements.txt
    echo "âœ… Froze package versions to requirements.txt"
}

# Main UV shell function
uvshell() {
    # Check for existing .venv
    if [[ -d ".venv" ]]; then
        echo "ğŸ” Found existing .venv directory"
        source .venv/bin/activate
    else
        echo "ğŸ“¦ Creating new virtual environment..."
        uv init
        UV_NO_WARN=1 uv venv && source .venv/bin/activate
    fi
    
    # Override 'pip' so it always calls 'uv pip' with the same arguments
    pip() {
        command uv pip "$@"
    }

    # Add uvfreeze command
    alias uvfreeze="freeze_packages"
    
    echo "âœ¨ Virtual environment activated with package tracking"
    echo "ğŸ“ Available commands:"
    echo "   - pip install <package(s)>  : Install packages - NOTE: replaces 'pip' with 'uv pip'"
    echo "   - uvfreeze                  : Freeze all installed packages to requirements.txt"
}