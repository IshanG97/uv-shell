# UV shell utilities
# Created: January 19, 2025

# Function to unset uv pip
uveject() {
    deactivate 2>/dev/null || true
    unset UV_ACTIVE
    unset -f pip
    unalias uvfreeze 2>/dev/null || true
    echo "üö™ Exited UV environment. 'pip' no longer overridden."
}

# Function to freeze packages to requirements.txt
freeze_packages() {
    if [[ -z "$VIRTUAL_ENV" ]]; then
        echo "‚ùå Not in a virtual environment"
        echo "üìù Run 'uvshell' first to activate your environment"
        return 1
    fi
    
    echo "üîÑ Freezing all installed packages to requirements.txt"
    uv pip freeze > requirements.txt
    echo "‚úÖ Froze package versions to requirements.txt"
}

# Main UV shell function
uvshell() {
    # Check for existing .venv
    if [[ -d ".venv" ]]; then
        echo "üîç Found existing .venv directory"
        source .venv/bin/activate
    else
        echo "üì¶ Creating new virtual environment..."
        uv init
        UV_NO_WARN=1 uv venv && source .venv/bin/activate
    fi
    # Mark that we are in UV environment
    export UV_ACTIVE=1
    
    # Override 'pip' so it always calls 'uv pip' with the same arguments
    pip() {
        command uv pip "$@"
    }

    # Add uvfreeze command
    alias uvfreeze="freeze_packages"
    
    echo "‚ú® Virtual environment activated with package tracking"
    echo "üìù Available commands:"
    echo "   - pip install <package(s)>  : Install packages - NOTE: replaces 'pip' with 'uv pip'"
    echo "   - uvfreeze                  : Freeze all installed packages to requirements.txt"
}